!function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){i(3),i(1),i(2),i(5),i(4),i(6)},function(e,t){var i=1e-5;AFRAME.registerComponent("fixedsize",{schema:{"default":1},init:function(){this.scale=1},update:function(){var e=this.data;this.scale=0===e?i:e},tick:function(e){var t=this.el.object3D,i=this.el.sceneEl.camera,a=i.getWorldPosition(),n=t.getWorldPosition(),o=n.distanceTo(a),s=o<i.near?this.scale:o*this.scale;t.scale.set(s,s,s)}}),AFRAME.registerComponent("trackvisibility",{schema:{"default":!0},init:function(){var e=this;console.log("INIT TEST COMPONENT"),this.el.sceneEl.addEventListener("referenceframe-statuschanged",function(t){e.updateVisibility(t)})},updateVisibility:function(e){console.log("visibility changed: "+e.detail.found),this.data&&e.detail.target===this.el&&(this.el.object3D.visible=e.detail.found)},update:function(){console.log("updated TEST COMPONENT")}})},function(e,t){var i=Argon.Cesium,a=i.Cartesian3,n=i.ConstantPositionProperty,o=i.ReferenceFrame,s=i.ReferenceEntity,r=THREE.Math.degToRad;AFRAME.registerComponent("referenceframe",{schema:{lla:{type:"vec3"},parent:{"default":"FIXED"},userotation:{"default":!0},useposition:{"default":!0}},init:function(){var e=this.el,t=this;if(this.update=this.update.bind(this),!e.sceneEl.isArgon)throw new Error("referenceframe must be used on a child of a <ar-scene>.");this.localRotationEuler=new THREE.Euler(0,0,0,"XYZ"),this.localPosition={x:0,y:0,z:0},this.localScale={x:1,y:1,z:1},this.knownFrame=!1,e.addEventListener("componentchanged",this.updateLocalTransform.bind(this)),e.sceneEl.addEventListener("argon-initialized",function(){t.update(t.data)})},update:function(e){var t=this.el,o=this.el.sceneEl.argonApp,s=this.data,l=t.getComputedAttribute("position");l?(this.localPosition.x=l.x,this.localPosition.y=l.y,this.localPosition.z=l.z):(this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0);var c=t.getComputedAttribute("rotation");c?(this.localRotationEuler.x=r(c.x),this.localRotationEuler.y=r(c.y),this.localRotationEuler.z=r(c.z)):(this.localRotationEuler.x=0,this.localRotationEuler.y=0,this.localRotationEuler.z=0);var d=t.getComputedAttribute("scale");if(d?(this.localScale.x=d.x,this.localScale.y=d.y,this.localScale.z=d.z):(this.localScale.x=1,this.localScale.y=1,this.localScale.z=1),o){var u=null;this.attrValue.hasOwnProperty("lla")?("FIXED"!==s.parent&&(console.warn("Using 'lla' with a 'parent' other than 'FIXED' is invalid. Ignoring parent value."),s.parent="FIXED"),u=a.fromDegrees(s.lla.x,s.lla.y,s.lla.z)):u=a.ZERO;var h=this.getParentEntity(s.parent);if(null==this.cesiumEntity||""!==t.id&&t.id!==this.cesiumEntity.id){var p={position:new n(u,h),orientation:i.Quaternion.IDENTITY};""!==t.id&&(p.id=t.id),this.cesiumEntity=new i.Entity(p)}else this.cesiumEntity.position.setValue(u,h)}},getParentEntity:function(e){var t=this.el,i=this,a=this.el.sceneEl.argonApp,n=null;if("FIXED"===e)n=o.FIXED;else{var r=t.sceneEl.systems.vuforia;if(r){var l=e.split(".");if(3===l.length&&"vuforia"===l[0]&&(console.log("looking for target '"+e+"'"),n=r.getTargetEntity(l[1],l[2]),null===n&&(console.log("not found, subscribing to target '"+e+"'"),n=r.subscribeToTarget(l[1],l[2])),null===n)){console.log("not loaded, waiting for dataset for target '"+e+"'");var c=l[1];t.sceneEl.addEventListener("argon-vuforia-dataset-loaded",function(e){console.log("dataset loaded."),console.log("dataset name '"+e.detail.target.name+"', our name '"+c+"'"),e.detail.target.name===c&&i.update(i.data)}),console.log("finished setting up to wait for dataset for target '"+e+"'")}}n||(n=a.context.entities.getById(e)),n||(n=new s(a.context.entities,e))}return n},convertReferenceFrame:function(e){var t=this.el;if(!this.cesiumEntity)return void console.warn("Tried to convertReferenceFrame on element '"+t.id+"' but no cesiumEntity initialized on that element")},updateLocalTransform:function(e){var t=e.detail.newData;e.target==this.el&&("rotation"==e.detail.name?(this.localRotationEuler.x=r(t.x),this.localRotationEuler.y=r(t.y),this.localRotationEuler.z=r(t.z)):"position"==e.detail.name?(this.localPosition.x=t.x,this.localPosition.y=t.y,this.localPosition.z=t.z):"scale"==e.detail.name&&(this.localScale.x=t.x,this.localScale.y=t.y,this.localScale.z=t.z))},tick:function(){var e=new THREE.Matrix4;return function(t){var i=this.data,a=this.el,n=a.object3D,o=n.matrix,s=a.sceneEl.argonApp,r=!a.parentEl.isScene;if(s&&this.cesiumEntity){var l=s.context.getEntityPose(this.cesiumEntity);l.poseStatus&Argon.PoseStatus.KNOWN?(this.knownFrame=!0,i.userotation?n.quaternion.copy(l.orientation):r&&(n.rotation.copy(this.localRotationEuler),n.rotation.order="YXZ"),i.useposition?n.position.copy(l.position):r&&n.position.copy(this.localPosition),l.poseStatus&Argon.PoseStatus.FOUND&&(console.log("reference frame changed to FOUND"),a.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!0})),a.parentEl.isScene||(n.scale.set(1,1,1),a.parentEl.object3D.updateMatrixWorld(),e.getInverse(a.parentEl.object3D.matrixWorld),o.premultiply(e),o.decompose(n.position,n.quaternion,n.scale))):(this.knownFrame=!1,l.poseStatus&Argon.PoseStatus.LOST&&(console.log("reference frame changed to LOST"),a.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!1})))}}}()}),AFRAME.registerPrimitive("ar-geopose",{defaultComponents:{referenceframe:{}},mappings:{lla:"referenceframe.lla",userotation:"referenceframe.userotation",useposition:"referenceframe.useposition"}}),AFRAME.registerPrimitive("ar-frame",{defaultComponents:{referenceframe:{}},mappings:{parent:"referenceframe.parent",userotation:"referenceframe.userotation",useposition:"referenceframe.useposition"}})},function(e,t){var i=AFRAME.AEntity,a=AFRAME.ANode,n="data-aframe-argon-camera",o=document.createElement("style");o.type="text/css",document.head.insertBefore(o,document.head.firstChild);var s=o.sheet;s.insertRule("ar-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n",0),s.insertRule("\nar-scene video,\nar-scene img,\nar-scene audio {\n  display: none;\n}\n",1),document.DOMReady=function(){return new Promise(function(e,t){"complete"===document.readyState?e(document):document.addEventListener("DOMContentLoaded",function(){e(document)})})},AFRAME.registerElement("ar-scene",{prototype:Object.create(i.prototype,{createdCallback:{value:function(){this.isMobile=AFRAME.utils.isMobile(),this.isIOS=AFRAME.utils.isIOS(),this.isScene=!0,this.isArgon=!0,this.object3D=new THREE.Scene,this.systems={},this.time=0,this.argonApp=null,this.init()}},init:{value:function(){this.behaviors=[],this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.argonApp=Argon.init(),this.argonApp.context.setDefaultReferenceFrame(this.argonApp.context.localOriginEastUpSouth),this.argonRender=this.argonRender.bind(this),this.argonUpdate=this.argonUpdate.bind(this),this.initializeArgon=this.initializeArgon.bind(this),this.setupRenderer=this.setupRenderer.bind(this),document.DOMReady().then(this.initializeArgon)},writable:!0},attachedCallback:{value:function(){this.setupSystems(),this.play()},writable:window.debug},addEventListeners:{value:function(){this.argonApp.renderEvent.addEventListener(this.argonRender),this.argonApp.updateEvent.addEventListener(this.argonUpdate)},writable:!0},removeEventListeners:{value:function(){this.argonApp.updateEvent.removeEventListener(this.argonUpdate),this.argonApp.renderEvent.removeEventListener(this.argonRender)},writable:!0},play:{value:function(){var e=this.sceneEl,t=this;return this.renderStarted?void i.prototype.play.call(this):(this.addEventListener("loaded",function(){if(!this.renderStarted){if(!this.camera||"AR-CAMERA"!==this.camera.el.tagName){var a=document.createElement("ar-camera");a.setAttribute(n,""),e.appendChild(a)}this.argonApp?e.addEventListeners():this.addEventListener("argon-initialized",function(){t.addEventListeners()}),i.prototype.play.call(this),window.performance&&window.performance.mark("render-started"),this.renderStarted=!0,this.emit("renderstart")}}),void setTimeout(function(){i.prototype.load.call(t)}))}},detachedCallback:{value:function(){this.animationFrameID&&(cancelAnimationFrame(this.animationFrameID),this.animationFrameID=null),removeEventListenern()}},initializeArgon:{value:function(){this.setupRenderer(),this.emit("argon-initialized",{target:this.argonApp})},writable:!0},setupRenderer:{value:function(){var e="true"===this.getAttribute("antialias");THREE.CSS3DArgonRenderer?this.cssRenderer=new THREE.CSS3DArgonRenderer:this.cssRenderer=null,THREE.CSS3DArgonHUD?this.hud=new THREE.CSS3DArgonHUD:this.hud=null,this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:e,logarithmicDepthBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.argonApp.view.element.appendChild(this.renderer.domElement),this.cssRenderer&&this.argonApp.view.element.appendChild(this.cssRenderer.domElement),this.hud&&this.argonApp.view.element.appendChild(this.hud.domElement)},writable:!0},reload:{value:function(e){function t(){n.isPlaying&&i.prototype.play.call(n)}var n=this;e&&this.pause(),this.innerHTML=this.originalHTML,this.init(),a.prototype.load.call(this,t)}},argonUpdate:{value:function(e){var t=e.systemTime,i=e.deltaTime;this.isPlaying&&this.tick(t,i),this.time=t},writable:!0},tick:{value:function(e,t){var i=this.systems;TWEEN.update(e),this.behaviors.forEach(function(i){i.el.isPlaying&&i.tick(e,t)}),Object.keys(i).forEach(function(a){i[a].tick&&i[a].tick(e,t)})}},argonRender:{value:function(e){if(!this.animationFrameID){var t=this.argonApp;this.rAFviewport=t.view.getViewport(),this.rAFsubViews=t.view.getSubviews(),this.animationFrameID=requestAnimationFrame(this.rAFRenderFunc.bind(this))}},writable:!0},rAFviewport:{value:null,writable:!0},rAFsubViews:{value:null,writable:!0},rAFRenderFunc:{value:function(){var e=this.object3D,t=this.renderer,i=this.cssRenderer,a=this.hud,n=this.camera;if(!this.renderer)return void(this.animationFrameID=null);var o=null,s=null;n.parent&&(o=n.parent.position.clone().negate(),s=n.parent.quaternion.clone().inverse());var r=this.rAFviewport;t.setSize(r.width,r.height),this.cssRenderer&&i.setSize(r.width,r.height),this.hud&&a.setSize(r.width,r.height);var l=this.rAFsubViews;this.is("vr-mode")?1==l.length&&(this.removeState("vr-mode"),this.emit("exit-vr",{target:this})):l.length>1&&(this.addState("vr-mode"),this.emit("enter-vr",{target:this})),n.near=l[0].frustum.near,n.far=l[0].frustum.far,n.aspect=l[0].frustum.aspect;for(var c=0;c<l.length;c++){var d=l[c],u=d.frustum;n.position.copy(d.pose.position),o&&n.position.add(o),n.quaternion.copy(d.pose.orientation),s&&n.quaternion.multiply(s),n.projectionMatrix.fromArray(d.projectionMatrix);var h=d.viewport,p=h.x,f=h.y,v=h.width,g=h.height;this.cssRenderer&&(n.fov=THREE.Math.radToDeg(u.fovy),i.setViewport(p,f,v,g,d.index),i.render(e,n,d.index)),t.setViewport(p,f,v,g),t.setScissor(p,f,v,g),t.setScissorTest(!0),t.render(e,n),this.hud&&(a.setViewport(p,f,v,g,d.index),a.render(d.index))}this.animationFrameID=null},writable:!0},setupSystems:{value:function(){var e=Object.keys(AFRAME.systems);e.forEach(this.initSystem.bind(this))}},initSystem:{value:function(e){var t;this.systems[e]||(t=this.systems[e]=new AFRAME.systems[e](this),t.init())}},addBehavior:{value:function(e){var t=this.behaviors;t.indexOf(e)===-1&&t.push(e)}},getAttribute:{value:function(e){var t=this.systems[e];return t?t.data:i.prototype.getAttribute.call(this,e)}},getComputedAttribute:{value:function(e){var t=this.systems[e];return t?t.data:i.prototype.getComputedAttribute.call(this,e)}},setAttribute:{value:function(e,t,n){var o=this.systems[e];return o?void a.prototype.setAttribute.call(this,e,t):void i.prototype.setAttribute.call(this,e,t,n)}},removeBehavior:{value:function(e){var t=this.behaviors,i=t.indexOf(e);i!==-1&&t.splice(i,1)}}})}),AFRAME.registerPrimitive("ar-camera",{defaultComponents:{camera:{active:!0},referenceframe:{parent:"ar.user"}}})},function(e,t){AFRAME.registerSystem("vuforia",{init:function(){this.key="",this.api=null,this.datasetMap={},this.available=!1,this.sceneEl.addEventListener("argon-initialized",this.startVuforia.bind(this))},setKey:function(e){this.key=e,this.sceneEl.argonApp&&this.startVuforia()},startVuforia:function(){var e=this,t=this.sceneEl,i=t.argonApp;i&&i.vuforia&&(this.api||""!==this.key&&i.vuforia.isAvailable().then(function(a){if(!e.available){if(!a)return e.available=!1,console.warn("vuforia not available on this platform."),void t.emit("argon-vuforia-not-available",{target:t});e.available=!0,i.vuforia.init({encryptedLicenseData:e.key}).then(function(i){e.api=i,console.log("vuforia initialized!"),Object.keys(e.datasetMap).forEach(function(t,i){var a=e.datasetMap[t];console.log("re-initializing dataset "+t+" as active="+a.active),e.createOrUpdateDataset(a.component,t,a.url,a.active)}),t.emit("argon-vuforia-initialized",{target:t})})["catch"](function(e){console.log("vuforia failed to initialize: "+e.message),t.emit("argon-vuforia-initialization-failed",{target:t,error:e})})}}))},createEmptyDatasetObject:function(){return{component:null,api:null,url:null,fetched:!1,loaded:!1,active:!1,targets:{},trackables:null,initInProgress:!1}},createOrUpdateDataset:function(e,t,i,a){var n=this,o=this.api,s=this.datasetMap[t];if(s)if(s.component){if(s.component!=e)return void console.warn("vuforia.createOrUpdateDataset called multiple times for id="+t+", ignoring extra datasets");if(s.url!=i)return void console.warn("can't change the url for a vuforia dataset once it's created.  Ignoring new URL '"+i+"' for dataset '"+t+"'")}else s.component=e,s.url=i;else s=this.datasetMap[t]=this.createEmptyDatasetObject(),s.component=e,s.url=i;if(s.active=a,console.log("creating dataset "+t+" active="+a),o){if(s.initInProgress)return void(s.active=a);if(s.api)return s.active=a,void(fetched&&n.setDatasetActive(t,s.active));console.log("objectTracker.createDataSet "+t),s.initInProgress=!0,o.objectTracker.createDataSet(i).then(function(e){console.log("created dataset "+t),s.initInProgress=!1,s.api=e,e.fetch().then(function(){console.log("fetched dataset "+t),s.fetched=!0,console.log("now, re-activate dataset "+t+" active="+s.active),n.setDatasetActive(t,s.active),s.component.datasetLoaded=!0,console.log("re-activated dataset "+t+" active="+s.active),n.sceneEl.emit("argon-vuforia-dataset-downloaded",{target:s.component})})["catch"](function(e){console.log("couldn't download dataset: "+e.message),sceneEl.emit("argon-vuforia-dataset-download-failed",{target:sceneEl,error:e})})})}},setDatasetActive:function(e,t){var i=this,a=this.api,n=this.datasetMap[e];if(console.log("make dataset "+e+" active="+t),!a){if(n)return void(n.active=t);throw new Error("vuforia.setDatsetActive call before dataset initialized")}if(!n)throw new Error('ar-vuforia-dataset "'+e+'" should have been created before being activated');console.log("really making dataset "+e+" active="+t),!n.loaded&&t?(console.log("loading dataset "+e+" active="+t),n.api.load().then(function(){console.log("loaded dataset "+e+" active="+t),n.loaded||(n.loaded=!0,n.fetched=!0,n.trackables=n.api.getTrackables(),t&&(n.active=!0,a.objectTracker.activateDataSet(n.api)),Object.keys(n.targets).forEach(function(t,a){console.log("re-subscribing to target "+e+"."+t),i.subscribeToTarget(e,t,!0)}),i.sceneEl.emit("argon-vuforia-dataset-loaded",{target:n.component}),console.log("dataset "+e+" loaded, ready to go"))})["catch"](function(e){console.log("couldn't load dataset: "+e.message),sceneEl.emit("argon-vuforia-dataset-load-failed",{target:sceneEl,error:e})})):n.active!=t&&(n.active=t,t?a.objectTracker.activateDataSet(n.api):a.objectTracker.deactivateDataSet(n.api))},subscribeToTarget:function(e,t,i){var a=this.api,n=this.datasetMap[e];if(n||(n=this.datasetMap[e]=this.createEmptyDatasetObject()),targetItem=n.targets[t],targetItem?i||(n.targets[t]+=1):n.targets[t]=1,console.log("subscribe to "+e+"."+t),!a)return null;if(n.loaded){var o=n.trackables[t];return console.log("dataset loaded, subscribe to "+e+"."+t),o&&o.id?(console.log("subscribed to "+e+"."+t+" as "+o.id),this.sceneEl.argonApp.context.subscribeToEntityById(o.id)):(console.warn("can't subscribe to target '"+t+"' does not exist in dataset '"+e+"'"),null)}return null},getTargetEntity:function(e,t){var i,a=this.api,n=this.datasetMap[e];return console.log("getTargetEntity "+e+"."+t),a&&n&&n.loaded?(i=n.trackables[t],console.log("everything loaded, get "+e+"."+t),i&&i.id?(console.log("retrieved "+e+"."+t+" as "+i.id),this.sceneEl.argonApp.context.entities.getById(i.id)):(console.warn("can't get target '"+t+"', does not exist in dataset '"+e+"'"),null)):null}}),AFRAME.registerComponent("vuforiakey",{schema:{"default":" "},init:function(){this.key=null},update:function(e){var t=this.el,i=this.el.sceneEl,a=i.systems.vuforia;if(!t.isArgon)return void console.warn("vuforia component can only be applied to <ar-scene>");var n=t.querySelector(this.data);return n?void(n.isAssetItem?(this.key=n.data,a.setKey(n.data)):(this.key=n.innerHTML,a.setKey(n.innerHTML))):void console.warn('vuforia component cannot find asset "'+this.data+'"')}}),AFRAME.registerComponent("vuforiadataset",{multiple:!0,schema:{src:{type:"src"},active:{"default":!0}},init:function(){var e=this.el;this.name="default_dataset",this.active=!1,this.datasetLoaded=!1,e.isArgon||console.warn("vuforiadataset should be attached to an <ar-scene>.")},remove:function(){if(this.active){var e=this.el.sceneEl,t=e.systems.vuforia;t.setDatasetActive(this.name,!1)}},update:function(e){var t=this.el.sceneEl;this.name=this.id?this.id:"default_dataset";var i=t.systems.vuforia;i.createOrUpdateDataset(this,this.name,this.data.src,this.data.active)}})},function(e,t){AFRAME.registerComponent("css-object",{schema:{div:{"default":""}},init:function(){this.div=null},update:function(){var e=this.data;if(""!==e.div){var t=document.querySelector(e.div);t&&THREE.CSS3DObject&&this.el.setObject3D("div",new THREE.CSS3DObject(t))}},remove:function(){this.div&&THREE.CSS3DObject&&this.el.removeObject3D("div")}})},function(e,t){AFRAME.registerShader("shadow",{schema:{},init:function(e){this.textureSrc=null,this.material=new THREE.ShadowMaterial,AFRAME.utils.material.updateMap(this,e)},update:function(e){AFRAME.utils.material.updateMap(this,e)}})}]);