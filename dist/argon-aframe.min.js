!function(t){function e(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(3),i(1),i(2),i(5),i(4),i(6)},function(t,e){AFRAME.registerComponent("fixedsize",{schema:{"default":1},init:function(){this.scale=1},update:function(){var t=this.data;this.scale=0===t?zeroScale:t},tick:function(t){var e=this.el.object3D,i=this.el.sceneEl.camera,a=i.getWorldPosition(),n=e.getWorldPosition(),o=n.distanceTo(a),s=o*this.scale;e.scale.set(s,s,s)}}),AFRAME.registerComponent("trackvisibility",{schema:{"default":!0},init:function(){var t=this;console.log("INIT TEST COMPONENT"),this.el.sceneEl.addEventListener("referenceframe-statuschanged",function(e){t.updateVisibility(e)})},updateVisibility:function(t){console.log("visibility changed: "+t.detail.found),this.data&&t.detail.target===this.el&&(this.el.object3D.visible=t.detail.found)},update:function(){console.log("updated TEST COMPONENT")}})},function(t,e){const i=Argon.Cesium,a=i.Cartesian3,n=i.ConstantPositionProperty,o=i.ReferenceFrame,s=i.ReferenceEntity;AFRAME.registerComponent("referenceframe",{schema:{lla:{type:"vec3"},parent:{"default":"FIXED"},userotation:{"default":!0},useposition:{"default":!0}},init:function(){var t=this.el,e=this;if(this.update=this.update.bind(this),!t.sceneEl.isArgon)throw new Error("referenceframe must be used on a child of a <ar-scene>.");this.localRotationEuler=new THREE.Euler(0,0,0,"XYZ"),this.localPosition={x:0,y:0,z:0},this.localMatrix=new THREE.Matrix4,t.object3D.matrixAutoUpdate=!1,t.addEventListener("componentchanged",this.updateLocalTransform.bind(this)),t.sceneEl.addEventListener("argon-initialized",function(){e.update(e.data)})},update:function(t){var e=this.el,r=this,l=this.el.sceneEl.argonApp,c=this.data,d=e.getComputedAttribute("position");d?(this.localPosition.x=d.x,this.localPosition.y=d.y,this.localPosition.z=d.z):(this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0);var u=e.getComputedAttribute("rotation");if(u?(this.localRotationEuler.x=u.x,this.localRotationEuler.y=u.y,this.localRotationEuler.z=u.z):(this.localRotationEuler.x=0,this.localRotationEuler.y=0,this.localRotationEuler.z=0),this.localMatrix.makeRotationFromEuler(this.localRotationEuler),this.localMatrix.setPosition(this.localPosition),l){var h=null;this.attrValue.hasOwnProperty("lla")?("FIXED"!==c.parent&&(console.warn("Using 'lla' with a 'parent' other than 'FIXED' is invalid. Ignoring parent value."),c.parent="FIXED"),h=a.fromDegrees(c.lla.x,c.lla.y,c.lla.z)):h=a.ZERO;var p;if("FIXED"===c.parent)p=o.FIXED;else{var f=e.sceneEl.systems.vuforia;if(f){var v=c.parent.split(".");if(3===v.length&&"vuforia"===v[0]&&(console.log("looking for target '"+c.parent+"'"),p=f.getTargetEntity(v[1],v[2]),null===p&&(console.log("not found, subscribing to target '"+c.parent+"'"),p=f.subscribeToTarget(v[1],v[2])),null===p)){console.log("not loaded, waiting for dataset for target '"+c.parent+"'");var g=v[1];e.sceneEl.addEventListener("argon-vuforia-dataset-loaded",function(t){console.log("dataset loaded."),console.log("dataset name '"+t.detail.target.name+"', our name '"+g+"'"),t.detail.target.name===g&&r.update(r.data)}),console.log("finished setting up to wait for dataset for target '"+c.parent+"'")}}p||(p=l.context.entities.getById(this.data.parent)),p||(p=new s(l.context.entities,this.data.parent))}if(null==this.cesiumEntity||""!==e.id&&e.id!==this.cesiumEntity.id){var m={position:new n(h,p),orientation:i.Quaternion.IDENTITY};""!==e.id&&(m.id=e.id),this.cesiumEntity=new i.Entity(m)}else this.cesiumEntity.position.setValue(h,p)}},updateLocalTransform:function(t){var e=t.detail.newData;"rotation"==t.detail.name?(this.localRotationEuler.x=e.x,this.localRotationEuler.y=e.y,this.localRotationEuler.z=e.z):"position"==t.detail.name&&(this.localPosition.x=e.x,this.localPosition.y=e.y,this.localPosition.z=e.z),this.localMatrix.makeRotationFromEuler(this.localRotationEuler),this.localMatrix.setPosition(this.localPosition)},tick:function(){var t=new THREE.Matrix4;return function(e){var i=this.data,a=this.el,n=a.object3D,o=n.matrix,s=a.sceneEl.argonApp;if(s){if(this.cesiumEntity){var r=s.context.getEntityPose(this.cesiumEntity);r.poseStatus&Argon.PoseStatus.KNOWN?(i.userotation?o.makeRotationFromQuaternion(r.orientation):o.identity(),i.useposition&&o.setPosition(r.position),r.poseStatus&Argon.PoseStatus.FOUND&&(console.log("reference frame changed to FOUND"),a.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!0})),a.parentEl.isScene||(t.getInverse(a.parentEl.object3D.matrixWorld),o.premultiply(t)),o.multiply(this.localMatrix),o.decompose(n.position,n.quaternion,n.scale)):r.poseStatus&Argon.PoseStatus.LOST&&(console.log("reference frame changed to LOST"),a.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!1}))}}else console.log("initial visibility set to false because argon not initialized"),a.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!1}),n.updateMatrix()}}()}),AFRAME.registerPrimitive("ar-geopose",{defaultComponents:{referenceframe:{}},mappings:{lla:"referenceframe.lla",userotation:"referenceframe.userotation",useposition:"referenceframe.useposition"}}),AFRAME.registerPrimitive("ar-frame",{defaultComponents:{referenceframe:{}},mappings:{parent:"referenceframe.parent",userotation:"referenceframe.userotation",useposition:"referenceframe.useposition"}})},function(t,e){var i=Argon.Cesium.JulianDate,a=AFRAME.AEntity,n=AFRAME.ANode,o="data-aframe-argon-camera",s=document.createElement("style");s.type="text/css",document.head.insertBefore(s,document.head.firstChild);var r=s.sheet;r.insertRule("ar-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n",0),r.insertRule("\nar-scene video,\nar-scene img,\nar-scene audio {\n  display: none;\n}\n",1),document.DOMReady=function(){return new Promise(function(t,e){"complete"===document.readyState?t(document):document.addEventListener("DOMContentLoaded",function(){t(document)})})},AFRAME.registerElement("ar-scene",{prototype:Object.create(a.prototype,{createdCallback:{value:function(){this.isMobile=AFRAME.utils.isMobile(),this.isIOS=AFRAME.utils.isIOS(),this.isScene=!0,this.isArgon=!0,this.object3D=new THREE.Scene,this.systems={},this.time=0,this.startTime=null,this.argonApp=null,this.init()}},init:{value:function(){this.behaviors=[],this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.argonRender=this.argonRender.bind(this),this.argonUpdate=this.argonUpdate.bind(this),this.initializeArgon=this.initializeArgon.bind(this),this.setupRenderer=this.setupRenderer.bind(this),document.DOMReady().then(this.initializeArgon)},writable:!0},attachedCallback:{value:function(){this.setupSystems(),this.play()},writable:window.debug},addEventListeners:{value:function(){this.argonApp.renderEvent.addEventListener(this.argonRender),this.argonApp.updateEvent.addEventListener(this.argonUpdate)},writable:!0},removeEventListeners:{value:function(){this.argonApp.updateEvent.removeEventListener(this.argonUpdate),this.argonApp.renderEvent.removeEventListener(this.argonRender)},writable:!0},play:{value:function(){var t=this.sceneEl,e=this;return this.renderStarted?void a.prototype.play.call(this):(this.addEventListener("loaded",function(){if(!this.renderStarted){if("AR-CAMERA"!==this.camera.el.tagName){var i=document.createElement("ar-camera");i.setAttribute(o,""),t.appendChild(i)}this.argonApp?t.addEventListeners():this.addEventListener("argon-initialized",function(){e.addEventListeners()}),a.prototype.play.call(this),window.performance&&window.performance.mark("render-started"),this.renderStarted=!0,this.emit("renderstart")}}),void setTimeout(function(){a.prototype.load.call(e)}))}},detachedCallback:{value:function(){removeEventListenern()}},initializeArgon:{value:function(){this.argonApp=Argon.init(),this.startTime=this.argonApp.context.getTime(),this.startTime&&(this.startTime=this.startTime.clone()),this.argonApp.context.setDefaultReferenceFrame(this.argonApp.context.localOriginEastUpSouth),this.setupRenderer(),this.emit("argon-initialized",{target:this.argonApp})},writable:!0},setupRenderer:{value:function(){var t="true"===this.getAttribute("antialias");this.cssRenderer=new THREE.CSS3DArgonRenderer,this.hud=new THREE.CSS3DArgonHUD,this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:t,logarithmicDepthBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.argonApp.view.element.appendChild(this.renderer.domElement),this.argonApp.view.element.appendChild(this.cssRenderer.domElement),this.argonApp.view.element.appendChild(this.hud.domElement)},writable:!0},reload:{value:function(t){function e(){i.isPlaying&&a.prototype.play.call(i)}var i=this;t&&this.pause(),this.innerHTML=this.originalHTML,this.init(),n.prototype.load.call(this,e)}},argonUpdate:{value:function(){var t=0;this.startTime&&(t=i.secondsDifference(this.argonApp.context.getTime(),this.startTime));var e=t-this.time;e>.5&&(e=0),this.isPlaying&&this.tick(t,e),this.time=t},writable:!0},tick:{value:function(t,e){var i=this.systems;TWEEN.update(t),this.behaviors.forEach(function(i){i.el.isPlaying&&i.tick(t,e)}),Object.keys(i).forEach(function(a){i[a].tick&&i[a].tick(t,e)})}},argonRender:{value:function(){var t=this.argonApp,e=this.object3D,i=this.renderer,a=this.cssRenderer,n=this.hud,o=this.camera,s=null,r=null;o.parent&&(s=o.parent.position.clone().negate(),r=o.parent.quaternion.clone().inverse());var l=t.view.getViewport();i.setSize(l.width,l.height),a.setSize(l.width,l.height),n.setSize(l.width,l.height);for(var c=0,d=t.view.getSubviews();c<d.length;c++){var u=d[c],h=u.frustum;o.position.copy(u.pose.position),s&&o.position.add(s),o.quaternion.copy(u.pose.orientation),r&&o.quaternion.multiply(r),o.projectionMatrix.fromArray(u.projectionMatrix);var p=u.viewport,f=p.x,v=p.y,g=p.width,m=p.height;o.fov=THREE.Math.radToDeg(h.fovy),a.setViewport(f,v,g,m,u.index),a.render(e,o,u.index),i.setViewport(f,v,g,m),i.setScissor(f,v,g,m),i.setScissorTest(!0),i.render(e,o),n.setViewport(f,v,g,m,u.index),n.render(u.index)}},writable:!0},setupSystems:{value:function(){var t=Object.keys(AFRAME.systems);t.forEach(this.initSystem.bind(this))}},initSystem:{value:function(t){var e;this.systems[t]||(e=this.systems[t]=new AFRAME.systems[t](this),e.init())}},addBehavior:{value:function(t){var e=this.behaviors;e.indexOf(t)===-1&&e.push(t)}},getAttribute:{value:function(t){var e=this.systems[t];return e?e.data:a.prototype.getAttribute.call(this,t)}},getComputedAttribute:{value:function(t){var e=this.systems[t];return e?e.data:a.prototype.getComputedAttribute.call(this,t)}},setAttribute:{value:function(t,e,i){var o=this.systems[t];return o?void n.prototype.setAttribute.call(this,t,e):void a.prototype.setAttribute.call(this,t,e,i)}},removeBehavior:{value:function(t){var e=this.behaviors,i=e.indexOf(t);i!==-1&&e.splice(i,1)}}})}),AFRAME.registerPrimitive("ar-camera",{defaultComponents:{camera:{active:!0},referenceframe:{parent:"ar.user"}}})},function(t,e){AFRAME.registerSystem("vuforia",{init:function(){this.key="",this.api=null,this.datasetMap={},this.available=!1,this.sceneEl.addEventListener("argon-initialized",this.startVuforia.bind(this))},setKey:function(t){this.key=t,this.sceneEl.argonApp&&this.startVuforia()},startVuforia:function(){var t=this,e=this.sceneEl,i=e.argonApp;i&&i.vuforia&&(this.api||""!==this.key&&i.vuforia.isAvailable().then(function(a){if(!t.available){if(!a)return t.available=!1,console.warn("vuforia not available on this platform."),void e.emit("argon-vuforia-not-available",{target:e});t.available=!0,i.vuforia.init({licenseKey:t.key}).then(function(i){t.api=i,console.log("vuforia initialized!"),Object.keys(t.datasetMap).forEach(function(e,i){var a=t.datasetMap[e];console.log("re-initializing dataset "+e+" as active="+a.active),t.createOrUpdateDataset(a.component,e,a.url,a.active)}),e.emit("argon-vuforia-initialized",{target:e})})}}))},createEmptyDatasetObject:function(){return{component:null,api:null,url:null,fetched:!1,loaded:!1,active:!1,targets:{},trackables:null,initInProgress:!1}},createOrUpdateDataset:function(t,e,i,a){var n=this,o=this.api,s=this.datasetMap[e];if(s)if(s.component){if(s.component!=t)return void console.warn("vuforia.createOrUpdateDataset called multiple times for id="+e+", ignoring extra datasets");if(s.url!=i)return void console.warn("can't change the url for a vuforia dataset once it's created.  Ignoring new URL '"+i+"' for dataset '"+e+"'")}else s.component=t,s.url=i;else s=this.datasetMap[e]=this.createEmptyDatasetObject(),s.component=t,s.url=i;if(s.active=a,console.log("creating dataset "+e+" active="+a),o){if(s.initInProgress)return void(s.active=a);if(s.api)return s.active=a,void(fetched&&n.setDatasetActive(e,s.active));console.log("objectTracker.createDataSet "+e),s.initInProgress=!0,o.objectTracker.createDataSet(i).then(function(t){console.log("created dataset "+e),s.initInProgress=!1,s.api=t,t.fetch().then(function(){console.log("fetched dataset "+e),s.fetched=!0,console.log("now, re-activate dataset "+e+" active="+s.active),n.setDatasetActive(e,s.active),s.component.datasetLoaded=!0,console.log("re-activated dataset "+e+" active="+s.active),n.sceneEl.emit("argon-vuforia-dataset-downloaded",{target:s.component})})})}},setDatasetActive:function(t,e){var i=this,a=this.api,n=this.datasetMap[t];if(console.log("make dataset "+t+" active="+e),!a){if(n)return void(n.active=e);throw new Error("vuforia.setDatsetActive call before dataset initialized")}if(!n)throw new Error('ar-vuforia-dataset "'+t+'" should have been created before being activated');console.log("really making dataset "+t+" active="+e),!n.loaded&&e?(console.log("loading dataset "+t+" active="+e),n.api.load().then(function(){console.log("loaded dataset "+t+" active="+e),n.loaded||(n.loaded=!0,n.fetched=!0,n.trackables=n.api.getTrackables(),e&&(n.active=!0,a.objectTracker.activateDataSet(n.api)),Object.keys(n.targets).forEach(function(e,a){console.log("re-subscribing to target "+t+"."+e),i.subscribeToTarget(t,e,!0)}),i.sceneEl.emit("argon-vuforia-dataset-loaded",{target:n.component}),console.log("dataset "+t+" loaded, ready to go"))})):n.active!=e&&(n.active=e,e?a.objectTracker.activateDataSet(n.api):a.objectTracker.deactivateDataSet(n.api))},subscribeToTarget:function(t,e,i){var a=this.api,n=this.datasetMap[t];if(n||(n=this.datasetMap[t]=this.createEmptyDatasetObject()),targetItem=n.targets[e],targetItem?i||(n.targets[e]+=1):n.targets[e]=1,console.log("subscribe to "+t+"."+e),!a)return null;if(n.loaded){var o=n.trackables[e];return console.log("dataset loaded, subscribe to "+t+"."+e),o&&o.id?(console.log("subscribed to "+t+"."+e+" as "+o.id),this.sceneEl.argonApp.context.subscribeToEntityById(o.id)):(console.warn("can't subscribe to target '"+e+"' does not exist in dataset '"+t+"'"),null)}return null},getTargetEntity:function(t,e){var i,a=this.api,n=this.datasetMap[t];return console.log("getTargetEntity "+t+"."+e),a&&n&&n.loaded?(i=n.trackables[e],console.log("everything loaded, get "+t+"."+e),i&&i.id?(console.log("retrieved "+t+"."+e+" as "+i.id),this.sceneEl.argonApp.context.entities.getById(i.id)):(console.warn("can't get target '"+e+"', does not exist in dataset '"+t+"'"),null)):null}}),AFRAME.registerComponent("vuforiakey",{schema:{"default":" "},init:function(){this.key=null},update:function(t){var e=this.el,i=this.el.sceneEl,a=i.systems.vuforia;if(!e.isArgon)return void console.warn("vuforia component can only be applied to <ar-scene>");var n=e.querySelector(this.data);return n?void(n.isAssetItem?(this.key=n.data,a.setKey(n.data)):(this.key=n.innerHTML,a.setKey(n.innerHTML))):void console.warn('vuforia component cannot find asset "'+this.data+'"')}}),AFRAME.registerComponent("vuforiadataset",{multiple:!0,schema:{src:{type:"src"},active:{"default":!0}},init:function(){var t=this.el;this.name="default_dataset",this.active=!1,this.datasetLoaded=!1,t.isArgon||console.warn("vuforiadataset should be attached to an <ar-scene>.")},remove:function(){if(this.active){var t=this.el.sceneEl,e=t.systems.vuforia;e.setDatasetActive(this.name,!1)}},update:function(t){var e=this.el.sceneEl;this.name=this.id?this.id:"default_dataset";var i=e.systems.vuforia;i.createOrUpdateDataset(this,this.name,this.data.src,this.data.active)}})},function(t,e){AFRAME.registerComponent("css-object",{schema:{div:{"default":""}},init:function(){this.div=null},update:function(){var t=this.data;if(""!==t.div){var e=document.querySelector(t.div);e&&this.el.setObject3D("div",new THREE.CSS3DObject(e))}},remove:function(){this.div&&this.el.removeObject3D("div")}})},function(t,e){AFRAME.registerShader("shadow",{schema:{},init:function(t){this.textureSrc=null,this.material=new THREE.ShadowMaterial,AFRAME.utils.material.updateMap(this,t)},update:function(t){AFRAME.utils.material.updateMap(this,t)}})}]);